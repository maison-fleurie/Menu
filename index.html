<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Menu ‚Äî Maison Fleurie</title>
  <meta name="description" content="D√©couvrez le menu de Maison Fleurie ‚Äî Table des Mets, Cocktails & Vins √† Montpellier." />
  <meta name="theme-color" content="#0D1F13" />

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="fr_FR" />
  <meta property="og:title" content="Menu ‚Äî Maison Fleurie" />
  <meta property="og:description" content="Table des Mets ‚Ä¢ Cocktails ‚Ä¢ Vins √† Montpellier" />
  <meta property="og:image" content="https://raw.githubusercontent.com/maison-fleurie/Menu/main/logo.png" />
  <meta property="og:url" content="" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Fonts & perf -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <!-- PapaParse (SRI + defer) -->
  <script defer src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    :root{
      /* Palette Premium - Tons Naturels et Raffin√©s */
      --deep-sage: #1A2E25;
      --sage-medium: #3D5A4C;
      --cream: #FAF8F4;
      --warm-white: #FFFFFF;
      --soft-gold: #C5B78F;
      --bronze: #9B8B6C;
      --charcoal: #2C2C2C;
      --text-primary: #1A2E25;
      --text-secondary: #5A6B62;
      --text-muted: #8A9B92;

      /* Shadows Premium */
      --shadow-sm: 0 1px 3px rgba(26, 46, 37, 0.04), 0 1px 2px rgba(26, 46, 37, 0.02);
      --shadow-md: 0 4px 12px rgba(26, 46, 37, 0.06), 0 2px 4px rgba(26, 46, 37, 0.03);
      --shadow-lg: 0 12px 24px rgba(26, 46, 37, 0.08), 0 4px 8px rgba(26, 46, 37, 0.04);
      --shadow-xl: 0 20px 40px rgba(26, 46, 37, 0.1), 0 8px 16px rgba(26, 46, 37, 0.06);

      /* Border Radius */
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;

      /* Spacing */
      --space-xs: 0.5rem;
      --space-sm: 0.75rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      --space-2xl: 3rem;
    }

    *{
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html{
      font-size: 16px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    html:focus-within{
      scroll-behavior: smooth;
    }

    body{
      margin: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(180deg, var(--cream) 0%, #F5F3EE 100%);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.65;
      letter-spacing: -0.011em;
    }

    a, button{
      outline-offset: 3px;
    }

    /* Header Premium */
    header.header{
      position: relative;
      text-align: center;
      background: linear-gradient(135deg, var(--deep-sage) 0%, var(--sage-medium) 100%);
      color: var(--cream);
      padding: var(--space-2xl) var(--space-lg) var(--space-xl);
      box-shadow: var(--shadow-lg);
      border-bottom: 1px solid rgba(197, 183, 143, 0.15);
    }

    .header-title{
      font-family: 'Cormorant Garamond', Georgia, serif;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-lg);
      margin: 0;
      font-size: 2.75rem;
      font-weight: 400;
      letter-spacing: 0.15em;
      line-height: 1.2;
      text-transform: uppercase;
    }

    .header-logo{
      height: 2.6rem;
      width: 2.6rem;
      object-fit: contain;
      filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.15));
      transition: transform 0.3s ease;
    }

    .header-logo:hover{
      transform: scale(1.05);
    }

    .header-subtitle{
      margin: var(--space-md) 0 0;
      font-size: 1.125rem;
      font-weight: 300;
      letter-spacing: 0.08em;
      color: var(--soft-gold);
      font-family: 'Inter', sans-serif;
    }

    /* Share Button */
    .share-btn{
      position: absolute;
      right: var(--space-lg);
      top: var(--space-lg);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: 1px solid rgba(197, 183, 143, 0.3);
      background: rgba(255, 255, 255, 0.1);
      color: var(--soft-gold);
      cursor: pointer;
      backdrop-filter: blur(8px);
      transition: all 0.2s ease;
    }

    .share-btn:hover{
      background: rgba(255, 255, 255, 0.18);
      border-color: rgba(197, 183, 143, 0.5);
      transform: translateY(-1px);
    }

    /* Search Container */
    .search-container{
      margin: var(--space-xl) auto var(--space-lg);
      max-width: 680px;
      padding: 0 var(--space-lg);
    }

    .search-row{
      display: flex;
      gap: var(--space-sm);
    }

    .search-box{
      flex: 1;
      padding: var(--space-md) var(--space-lg);
      font-size: 1rem;
      border-radius: var(--radius-lg);
      border: 1px solid rgba(26, 46, 37, 0.12);
      background: var(--warm-white);
      box-shadow: var(--shadow-sm);
      color: var(--text-primary);
      font-family: 'Inter', sans-serif;
      transition: all 0.2s ease;
    }

    .search-box::placeholder{
      color: var(--text-muted);
    }

    .search-box:focus{
      border-color: var(--sage-medium);
      box-shadow: var(--shadow-md), 0 0 0 3px rgba(61, 90, 76, 0.08);
      background: var(--warm-white);
      outline: none;
    }

    .clear-btn{
      border: 1px solid rgba(26, 46, 37, 0.12);
      background: var(--warm-white);
      border-radius: var(--radius-lg);
      padding: var(--space-md) var(--space-lg);
      cursor: pointer;
      font-size: 0.875rem;
      color: var(--text-secondary);
      transition: all 0.2s ease;
      font-family: 'Inter', sans-serif;
      opacity: 0;
      pointer-events: none;
    }

    .clear-btn.visible{
      opacity: 1;
      pointer-events: auto;
    }

    .clear-btn:hover{
      background: var(--cream);
      border-color: var(--sage-medium);
    }

    .search-results-info{
      font-size: 0.9375rem;
      color: var(--text-secondary);
      margin: var(--space-md) 0;
      font-weight: 500;
      text-align: center;
      padding: var(--space-sm) var(--space-lg);
      background: var(--warm-white);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
      border: 1px solid rgba(26, 46, 37, 0.08);
    }

    /* Main Container */
    main.container{
      max-width: 880px;
      margin: var(--space-lg) auto var(--space-2xl);
      background: var(--warm-white);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      border: 1px solid rgba(26, 46, 37, 0.08);
    }

    /* Tab Navigation */
    .tab-btn{
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
    }

    .tab-btn .ico{
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
    }

    .tab-btn .ico svg{
      width: 18px;
      height: 18px;
      display: block;
    }

    nav.tab-nav{
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      background: linear-gradient(180deg, var(--cream) 0%, var(--warm-white) 100%);
      border-bottom: 1px solid rgba(26, 46, 37, 0.1);
      gap: var(--space-xs);
      padding: var(--space-lg);
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(12px);
    }

    .tab-btn{
      background: var(--warm-white);
      border: 1px solid rgba(26, 46, 37, 0.15);
      padding: var(--space-sm) var(--space-md);
      font-size: 0.9375rem;
      cursor: pointer;
      font-weight: 500;
      color: var(--text-primary);
      border-radius: var(--radius-md);
      position: relative;
      box-shadow: var(--shadow-sm);
      transition: all 0.2s ease;
      font-family: 'Inter', sans-serif;
    }

    .tab-btn:hover{
      background: var(--cream);
      border-color: var(--sage-medium);
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .tab-btn[aria-selected="true"]{
      background: linear-gradient(135deg, var(--deep-sage) 0%, var(--sage-medium) 100%);
      color: var(--cream);
      border-color: var(--bronze);
      box-shadow: var(--shadow-md);
    }

    /* Tab Content */
    .tab-content{
      display: none;
      padding: var(--space-xl) var(--space-lg);
      background: var(--warm-white);
      min-height: 420px;
    }

    .tab-content.active{
      display: block;
    }

    /* Menu Items - Premium Design */
    .menu-item{
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: var(--space-lg);
      padding: var(--space-sm) var(--space-md);
      border-bottom: 1px solid rgba(26, 46, 37, 0.06);
      background: linear-gradient(180deg, rgba(250, 248, 244, 0.3) 0%, rgba(255, 255, 255, 0.5) 100%);
      border-radius: var(--radius-md);
      transition: all 0.2s ease;
    }

    .menu-item:hover{
      background: rgba(250, 248, 244, 0.6);
      box-shadow: var(--shadow-sm);
      transform: translateX(2px);
    }

    .menu-item + .menu-item{
      margin-top: var(--space-sm);
    }

    .item-info{
      flex: 1;
      min-width: 0;
    }

    .item-name{
      font-size: 1.375rem;
      font-weight: 600;
      color: var(--text-primary);
      letter-spacing: -0.01em;
      line-height: 1.4;
      font-family: 'Cormorant Garamond', Georgia, serif;
    }

    .item-section{
      font-size: 0.75rem;
      color: var(--text-muted);
      margin: var(--space-xs) 0 var(--space-sm);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.9;
    }

    .item-description{
      font-size: 0.9375rem;
      color: var(--text-secondary);
      font-style: italic;
      margin-top: var(--space-xs);
      line-height: 1.5;
      font-weight: 400;
    }

    .item-price{
      font-size: 1.0625rem;
      color: var(--text-primary);
      font-weight: 600;
      background: linear-gradient(135deg, rgba(197, 183, 143, 0.15) 0%, rgba(197, 183, 143, 0.08) 100%);
      border-radius: var(--radius-md);
      padding: var(--space-sm) var(--space-md);
      min-width: 80px;
      text-align: center;
      border: 1px solid rgba(197, 183, 143, 0.2);
      white-space: nowrap;
    }

    /* Section Titles */
    .section-title{
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.875rem;
      font-weight: 500;
      color: var(--text-primary);
      margin: var(--space-xl) 0 var(--space-lg);
      text-align: center;
      letter-spacing: 0.02em;
      position: relative;
    }

    .section-title::after{
      content: '';
      position: absolute;
      bottom: -12px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--soft-gold), transparent);
      border-radius: 2px;
    }

    /* Sticky Section Header */
    .sticky-section-header{
      position: sticky;
      top: 0;
      z-index: 20;
      background: linear-gradient(135deg, var(--deep-sage) 0%, var(--sage-medium) 100%);
      color: var(--cream);
      padding: var(--space-sm) var(--space-lg);
      text-align: center;
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.125rem;
      font-weight: 500;
      letter-spacing: 0.05em;
      box-shadow: var(--shadow-md);
      border-bottom: 1px solid rgba(197, 183, 143, 0.3);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .sticky-section-header.visible{
      opacity: 1;
    }

    /* Back to Top Button */
    .back-to-top{
      position: fixed;
      bottom: var(--space-xl);
      right: var(--space-xl);
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--deep-sage) 0%, var(--sage-medium) 100%);
      color: var(--cream);
      border: 2px solid rgba(197, 183, 143, 0.4);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-lg);
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s ease;
    }

    .back-to-top.visible{
      opacity: 1;
      pointer-events: auto;
    }

    .back-to-top:hover{
      transform: translateY(-3px);
      box-shadow: var(--shadow-xl);
      background: linear-gradient(135deg, var(--sage-medium) 0%, var(--deep-sage) 100%);
    }

    .back-to-top svg{
      width: 24px;
      height: 24px;
    }

    .now-title{
      font-size: 1.5rem;
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-weight: 500;
      color: var(--sage-medium);
      margin: var(--space-lg) 0;
      text-align: center;
      letter-spacing: 0.02em;
    }

    /* Empty State */
    .empty-state{
      text-align: center;
      color: var(--text-secondary);
      margin: var(--space-xl) 0;
      padding: var(--space-xl) var(--space-lg);
      background: linear-gradient(180deg, rgba(250, 248, 244, 0.4) 0%, rgba(255, 255, 255, 0.6) 100%);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(26, 46, 37, 0.08);
    }

    .empty-state h3{
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.25rem;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: var(--space-sm);
    }

    /* Skeleton Loader */
    .skeleton{
      display: block;
      height: 16px;
      background: linear-gradient(90deg, #f0f0f0, #f8f8f8, #f0f0f0);
      background-size: 200px 100%;
      border-radius: var(--radius-sm);
      animation: sheen 1.8s ease-in-out infinite;
    }

    .skeleton.big{
      height: 22px;
    }

    @keyframes sheen{
      0%{
        background-position: -200px 0;
      }
      100%{
        background-position: calc(200px + 100%) 0;
      }
    }

    /* Wine Decision Tree */
    .wine-tree{
      padding: var(--space-xl) var(--space-lg);
    }

    .wine-tree-header{
      display: flex;
      align-items: center;
      gap: var(--space-md);
      margin-bottom: var(--space-xl);
      justify-content: center;
    }

    .wine-tree-title{
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.875rem;
      font-weight: 500;
      color: var(--text-primary);
      margin: 0;
      letter-spacing: 0.01em;
    }

    .wine-icon{
      width: 28px;
      height: 28px;
      color: var(--soft-gold);
    }

    .progress-bar{
      display: flex;
      gap: var(--space-xs);
      margin-bottom: var(--space-md);
    }

    .progress-step{
      flex: 1;
      height: 6px;
      background: rgba(197, 183, 143, 0.2);
      border-radius: var(--radius-sm);
      transition: all 0.3s ease;
    }

    .progress-step.active{
      background: linear-gradient(90deg, var(--soft-gold), var(--bronze));
    }

    .progress-info{
      text-align: center;
      color: var(--text-secondary);
      font-size: 0.875rem;
      margin-bottom: var(--space-md);
      font-weight: 500;
    }

    .question-title{
      font-size: 1.5rem;
      font-weight: 500;
      font-family: 'Cormorant Garamond', Georgia, serif;
      color: var(--text-primary);
      margin-bottom: var(--space-lg);
      text-align: center;
      letter-spacing: 0.01em;
    }
    
    .wine-options{
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .wine-option{
      width: 100%;
      padding: var(--space-md) var(--space-lg);
      text-align: left;
      border: 1px solid rgba(26, 46, 37, 0.15);
      border-radius: var(--radius-lg);
      background: var(--warm-white);
      cursor: pointer;
      transition: all 0.25s ease;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-family: 'Inter', sans-serif;
      box-shadow: var(--shadow-sm);
    }

    .wine-option:hover{
      border-color: var(--sage-medium);
      background: var(--cream);
      transform: translateX(3px);
      box-shadow: var(--shadow-md);
    }

    .wine-option-content{
      flex: 1;
    }

    .wine-option-label{
      font-size: 1rem;
      font-weight: 500;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: var(--space-xs);
    }

    .wine-option-desc{
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-top: var(--space-xs);
      font-style: italic;
      font-weight: 400;
      line-height: 1.5;
    }

    .wine-option-icon{
      font-size: 1.375rem;
    }

    .wine-color-dot{
      display: inline-block;
      width: 0.75rem;
      height: 0.75rem;
      border-radius: 50%;
      background: var(--dot-color, rgba(197, 183, 143, 0.55));
      border: 1px solid rgba(26, 46, 37, 0.2);
      box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.7);
    }

    .chevron-icon{
      width: 18px;
      height: 18px;
      color: var(--soft-gold);
      transition: transform 0.2s ease;
    }

    .wine-option:hover .chevron-icon{
      transform: translateX(4px);
    }

    .wine-nav-btns{
      display: flex;
      gap: var(--space-sm);
      margin-top: var(--space-xl);
      justify-content: center;
      flex-wrap: wrap;
    }

    .wine-btn{
      padding: var(--space-sm) var(--space-lg);
      border-radius: var(--radius-lg);
      font-size: 0.9375rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid rgba(26, 46, 37, 0.15);
      display: flex;
      align-items: center;
      gap: var(--space-xs);
      font-family: 'Inter', sans-serif;
    }

    .wine-btn-back{
      background: var(--warm-white);
      border: 1px solid rgba(26, 46, 37, 0.15);
      color: var(--text-primary);
    }

    .wine-btn-back:hover{
      background: var(--cream);
      border-color: var(--sage-medium);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .wine-btn-primary{
      background: linear-gradient(135deg, var(--deep-sage) 0%, var(--sage-medium) 100%);
      color: var(--cream);
      border: 1px solid var(--bronze);
    }

    .wine-btn-primary:hover{
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .wine-btn-secondary{
      background: var(--warm-white);
      border: 1px solid rgba(26, 46, 37, 0.2);
      color: var(--text-primary);
    }

    .wine-btn-secondary:hover{
      background: var(--cream);
      border-color: var(--sage-medium);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }
    
    /* Wine Recommendations */
    .wine-recommendations{
      padding: var(--space-xl) var(--space-lg);
    }

    .reco-header{
      display: flex;
      align-items: center;
      gap: var(--space-md);
      margin-bottom: var(--space-xl);
      justify-content: center;
    }

    .reco-title{
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 1.875rem;
      font-weight: 500;
      color: var(--text-primary);
      margin: 0;
      letter-spacing: 0.01em;
    }

    .wine-card{
      border: 1px solid rgba(26, 46, 37, 0.12);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      margin-bottom: var(--space-sm);
      background: linear-gradient(180deg, rgba(250, 248, 244, 0.4) 0%, rgba(255, 255, 255, 0.8) 100%);
      transition: all 0.25s ease;
      box-shadow: var(--shadow-sm);
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .wine-card-badges{
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.25rem;
    }

    .wine-badge{
      display: inline-flex;
      align-items: center;
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.03em;
      border-radius: 999px;
      padding: 0.35rem 0.75rem;
      background: rgba(26, 46, 37, 0.08);
      color: var(--text-primary);
      border: 1px solid transparent;
    }

    .wine-badge-reco{
      background: rgba(255, 255, 255, 0.92);
      border: 1px solid rgba(155, 139, 108, 0.55);
      color: var(--deep-sage);
      box-shadow: 0 4px 12px rgba(155, 139, 108, 0.18);
    }

    .wine-badge-glass{
      background: rgba(61, 90, 76, 0.1);
      color: var(--sage-medium);
      border-color: rgba(61, 90, 76, 0.25);
    }

    .wine-badge-local{
      background: rgba(250, 248, 244, 0.92);
      border: 1px solid rgba(197, 183, 143, 0.45);
      color: var(--bronze);
    }

    .wine-card:hover{
      border-color: var(--sage-medium);
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
      background: rgba(250, 248, 244, 0.6);
    }

    .wine-card-header{
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: var(--space-sm);
      gap: var(--space-lg);
    }

    .wine-card-name{
      font-size: 1.125rem;
      font-weight: 500;
      font-family: 'Cormorant Garamond', Georgia, serif;
      color: var(--text-primary);
      flex: 1;
      line-height: 1.4;
      letter-spacing: -0.01em;
    }

    .wine-card-price{
      font-size: 1.0625rem;
      font-weight: 600;
      color: var(--text-primary);
      background: var(--warm-white);
      border: 1px solid rgba(197, 183, 143, 0.3);
      padding: var(--space-xs) var(--space-md);
      border-radius: var(--radius-md);
      white-space: nowrap;
    }

    .wine-card-region{
      color: var(--text-secondary);
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: var(--space-xs);
    }

    .wine-card-grapes{
      color: var(--text-muted);
      font-size: 0.8125rem;
      margin-bottom: var(--space-sm);
      font-weight: 400;
      font-style: italic;
      line-height: 1.5;
    }

    /* Responsive Design */
    @media (max-width: 768px){
      .header-title{
        font-size: 2rem;
        gap: var(--space-md);
        letter-spacing: 0.1em;
      }

      .header-logo{
        height: 2.2rem;
        width: 2.2rem;
      }

      .header-subtitle{
        font-size: 1rem;
      }

      .share-btn{
        right: var(--space-md);
        top: var(--space-md);
        width: 40px;
        height: 40px;
      }

      .search-container{
        padding: 0 var(--space-md);
      }

      .menu-item{
        flex-direction: row;
        align-items: flex-start;
        gap: var(--space-md);
      }

      .item-price{
        flex-shrink: 0;
        margin-top: 0;
      }

      .wine-card-header{
        flex-direction: column;
        gap: var(--space-sm);
      }

      .wine-card-price{
        align-self: flex-start;
      }

      .wine-nav-btns{
        flex-direction: column;
      }

      .wine-btn{
        width: 100%;
        justify-content: center;
      }

      .tab-nav{
        padding: var(--space-md);
        gap: var(--space-xs);
      }

      .tab-btn{
        font-size: 0.875rem;
        padding: var(--space-xs) var(--space-sm);
      }

      .section-title{
        font-size: 1.625rem;
      }

      .wine-tree-title, .reco-title{
        font-size: 1.5rem;
      }

      .question-title{
        font-size: 1.25rem;
      }
    }

    @media (max-width: 480px){
      .header-title{
        font-size: 1.75rem;
        flex-direction: column;
        gap: var(--space-sm);
      }

      .header-logo{
        height: 2rem;
        width: 2rem;
      }

      main.container{
        border-radius: var(--radius-md);
        margin: var(--space-md) var(--space-xs) var(--space-xl);
      }

      .search-row{
        flex-direction: row;
      }

      .clear-btn{
        padding: var(--space-md) var(--space-md);
        min-width: 44px;
        flex-shrink: 0;
      }
    }

    /* Splash Screen Premium */
    #splashScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: linear-gradient(135deg, var(--deep-sage) 0%, var(--sage-medium) 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 1;
      transition: opacity 0.5s ease;
    }

    #splashScreen.fade-out {
      opacity: 0;
      pointer-events: none;
    }

    .splash-logo {
      width: 320px;
      max-width: 85vw;
      height: auto;
      object-fit: contain;
      filter: drop-shadow(0 8px 32px rgba(0, 0, 0, 0.3));
      animation: splashPulse 2s ease-in-out infinite;
    }

    .splash-loader {
      width: 40px;
      height: 40px;
      margin-top: var(--space-2xl);
      border: 3px solid rgba(197, 183, 143, 0.3);
      border-top-color: var(--soft-gold);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes splashPulse {
      0%, 100% {
        transform: scale(1);
        opacity: 0.95;
      }
      50% {
        transform: scale(1.02);
        opacity: 1;
      }
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    @media (max-width: 768px) {
      .splash-logo {
        width: 280px;
      }
    }

    @media (max-width: 480px) {
      .splash-logo {
        width: 240px;
      }
    }

    /* Footer */
    footer.footer{
      text-align: center;
      padding: var(--space-lg);
      color: var(--text-secondary);
      font-size: 0.875rem;
      font-weight: 500;
      background: var(--warm-white);
      border-top: 1px solid rgba(26, 46, 37, 0.08);
      margin-top: var(--space-xl);
    }
  </style>
</head>
<body>
  <!-- Splash Screen Premium -->
  <div id="splashScreen">
    <img src="./logo_chargement.png" alt="Maison Fleurie" class="splash-logo" />
    <div class="splash-loader"></div>
  </div>

  <header class="header" role="banner">
    <h1 class="header-title"><span>MAISON</span>
      <img src="https://raw.githubusercontent.com/maison-fleurie/Menu/main/logo.png" alt="Logo Maison Fleurie" class="header-logo" />
      <span>FLEURIE</span></h1>
    
    <button id="btnShare" class="share-btn" aria-label="Partager" title="Partager" tabindex="0">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.02-4.11A2.99 2.99 0 0 0 18 7.91c1.66 0 3-1.34 3-3S19.66 2 18 2s-3 1.34-3 3c0 .24.04.47.09.7l-7.02 4.11A2.99 2.99 0 0 0 6 9.91c-1.66 0-3 1.34-3 3s1.34 3 3 3c.82 0 1.56-.33 2.09-.87l7.02 4.11c-.05.21-.08.43-.08.66 0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3Z"/></svg>
    </button>
    <p class="header-subtitle">Table des Mets ‚Ä¢ Cocktails ‚Ä¢ Vins</p>
  </header>

  <!-- Sticky Section Header -->
  <div id="stickySectionHeader" class="sticky-section-header"></div>

  <noscript>
    <style>.nojs{max-width:900px;margin:1rem auto;background:#fff;border:1px solid #c00;color:#111;padding:1rem;border-radius:12px}</style>
    <div class="nojs">‚ö†Ô∏è JavaScript est d√©sactiv√©. Activez‚Äële pour voir le menu interactif.</div>
  </noscript>

  <div class="search-container">
    <div class="search-row">
      <input id="searchBox" class="search-box" type="search" placeholder="Rechercher‚Ä¶ (ex: Vin, Bi√®re, Karaage poulet)" autocomplete="off" />
      <button id="clearSearch" class="clear-btn" aria-label="Effacer">‚úñ</button>
    </div>
    <div id="searchInfo" class="search-results-info" style="display:none"></div>
  </div>

  <main id="main" class="container" role="main">
    <nav class="tab-nav" role="tablist">
      <button id="tab-now" class="tab-btn" role="tab" aria-selected="true" data-tab="now"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3l2 5 5 2-5 2-2 5-2-5-5-2 5-2z"/></svg></span><span>En ce moment</span></button>
      <button id="tab-deguster" class="tab-btn" role="tab" aria-selected="false" data-tab="deguster"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"><path d="M7 3v10M11 3v10M5 7h8M16 4h3v9a3 3 0 0 1-3 3h-3"/></svg></span><span>D√©guster</span></button>
      <button id="tab-cocktails" class="tab-btn" role="tab" aria-selected="false" data-tab="cocktails"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"><path d="M3 4h18l-7 7v7h-4v-7z"/></svg></span><span>Cocktails</span></button>
      <button id="tab-chaudes" class="tab-btn" role="tab" aria-selected="false" data-tab="chaudes"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"><path d="M4 8h12a4 4 0 0 1 0 8H4z"/><path d="M7 4c0 2 2 2 2 4s-2 2-2 4"/></svg></span><span>Chaudes</span></button>
      <button id="tab-bieres" class="tab-btn" role="tab" aria-selected="false" data-tab="bieres"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"><path d="M7 8h8v12H7z"/><path d="M15 10h2a3 3 0 0 1 0 6h-2"/></svg></span><span>Bi√®res</span></button>
      <button id="tab-softs" class="tab-btn" role="tab" aria-selected="false" data-tab="softs"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"><path d="M7 7h10l-2 13H9z"/><path d="M9 11h8"/></svg></span><span>Softs</span></button>
      <button id="tab-vins" class="tab-btn" role="tab" aria-selected="false" data-tab="vins"><span class="ico"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"><path d="M7 3h10l-1 6a6 6 0 1 1-8 0z"/><path d="M12 15v6"/></svg></span><span>Vins</span></button>
    </nav>

    <section id="panel-now" class="tab-content active"></section>
    <section id="panel-deguster" class="tab-content"></section>
    <section id="panel-cocktails" class="tab-content"></section>
    <section id="panel-chaudes" class="tab-content"></section>
    <section id="panel-bieres" class="tab-content"></section>
    <section id="panel-softs" class="tab-content"></section>
    <section id="panel-vins" class="tab-content"></section>

    <div id="errorContainer" class="empty-state" style="display:none">
      <h3>Oups ! Impossible de charger le menu</h3>
      <p>V√©rifiez votre connexion et r√©essayez.</p>
      <button id="retryBtn">üîÑ R√©essayer</button>
    </div>
  </main>

  <footer class="footer">
    Prix net TTC & service compris<br>
    Pour toute information concernant les allerg√®nes, veuillez vous renseigner aupr√®s de notre √©quipe
  </footer>

  <!-- Back to Top Button -->
  <button id="backToTop" class="back-to-top" aria-label="Retour en haut" title="Retour en haut">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M12 19V5M5 12l7-7 7 7"/>
    </svg>
  </button>

  <script>
    if (typeof window !== 'undefined' && typeof window.invoke === 'undefined') {
      window.invoke = function(){ console.warn('[shim] window.invoke() non d√©fini'); };
    }

    const CSV_URL = 'https://docs.google.com/spreadsheets/d/1lgd-rGS2kLCn0yPtGMc7RyMDue-YERmKOjNT3QKgJ3Y/export?format=csv&gid=0';
    const CACHE_KEY = 'mf-menu-v1'; const CACHE_AT = 'mf-menu-at'; const CACHE_TTL = 15*60*1000;

    let allMenuData = [], wineData = [], currentTab = 'now', isSearching = false, searchTimeout;
    let wineTreeStep = 0, wineTreeSelections = {}, showingWineList = false;
    let lastQuery = '', lastSearchResults = [], placeholderInterval;

    const normalize = (s='') => s.toString().normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase().trim();
    const tabIdFromOnglet = (s='') => normalize(s).replace(/\s/g,'');
    const formatPrice = (raw='') => {
      const str = String(raw).trim();
      if (!str || /‚Ç¨|\//.test(str)) return str;
      const num = Number(str.replace(',','.'));
      return (!isNaN(num) && Number.isInteger(num)) ? `${num}‚Ç¨` : str;
    };
    const getPriceValue = (raw='') => {
      const matches = String(raw).match(/(\d+(?:[.,]\d+)?)/g);
      if (!matches) return Number.POSITIVE_INFINITY;
      const numbers = matches
        .map(n => parseFloat(n.replace(',', '.')))
        .filter(n => Number.isFinite(n));
      if (!numbers.length) return Number.POSITIVE_INFINITY;
      return Math.min(...numbers);
    };
    const byNameFR = (a,b) => (a?.Nom||'').localeCompare(b?.Nom||'','fr',{sensitivity:'base'});
    const compareByPrice = (a, b) => {
      const priceA = getPriceValue(a?.Prix);
      const priceB = getPriceValue(b?.Prix);
      const bothFinite = Number.isFinite(priceA) && Number.isFinite(priceB);
      if (bothFinite && priceA !== priceB) return priceA - priceB;
      if (Number.isFinite(priceA) && !Number.isFinite(priceB)) return -1;
      if (!Number.isFinite(priceA) && Number.isFinite(priceB)) return 1;
      return byNameFR(a, b);
    };
    const compareWineByPrice = compareByPrice; // Alias pour les vins
    const qs = sel => document.querySelector(sel);
    const qsa = sel => Array.from(document.querySelectorAll(sel));

    // Ordre des sections pour "D√©guster" uniquement
    const DEGUSTER_SECTION_ORDER = ['Veggie', 'Terre', 'Mer', 'Fromages & Charcuterie', 'Desserts'];
    const getSectionOrderIndex = (sectionName, tabName) => {
      if (normalize(tabName) !== 'deguster') return -1;
      const idx = DEGUSTER_SECTION_ORDER.findIndex(s => normalize(s) === normalize(sectionName));
      return idx === -1 ? 999 : idx;
    };

    // --- Guide de s√©lection des vins ---
    const getWineTag = (wine, key) => {
      if (!wine || !key) return '';
      if (Object.prototype.hasOwnProperty.call(wine, key)) return wine[key];
      if (key.includes('-')) {
        const alt = key.replace(/-/g, '_');
        if (Object.prototype.hasOwnProperty.call(wine, alt)) return wine[alt];
      }
      if (key.includes('_')) {
        const alt = key.replace(/_/g, '-');
        if (Object.prototype.hasOwnProperty.call(wine, alt)) return wine[alt];
      }
      return wine[key] || '';
    };

    const toTitle = (value = '') => value.split(/\s+/).filter(Boolean).map(part => part.charAt(0).toUpperCase() + part.slice(1)).join(' ');
    const canonicalSubstyle = (raw = '') => {
      let norm = normalize(raw);
      if (!norm) return '';
      if (norm.startsWith('sec ')) norm = norm.replace(/^sec\s+/, '');
      return norm;
    };

    const SUBSTYLE_META = {
      fruite: { label: 'Sec fruit√©', desc: 'Gourmand, notes de fruits blancs et jaunes.' },
      sec: { label: 'Sec', desc: 'Profil tr√®s droit, vif et d√©salt√©rant.' },
      mineral: { label: 'Sec min√©ral', desc: 'Salinit√©, pierre √† fusil, tension √©l√©gante.' },
      rond: { label: 'Sec rond', desc: 'Ampleur, notes beurr√©es et texture velout√©e.' }
    };
    const SUBSTYLE_ORDER = ['fruite', 'sec', 'mineral', 'rond'];
    const getSubstyleMeta = (norm, raw = '') => {
      const meta = SUBSTYLE_META[norm];
      if (meta) return meta;
      return { label: toTitle(raw || norm), desc: '' };
    };

    const PROVENANCE_META = {
      local: { label: 'S√©lection locale', desc: 'Vignerons du Languedoc & Occitanie.' },
      decouverte: { label: 'Escapade & d√©couverte', desc: 'Autres r√©gions & voyages gustatifs.' }
    };
    const PROVENANCE_ORDER = ['local', 'decouverte'];
    const PROVENANCE_LOCAL_KEYWORDS = ['local', 'languedoc', 'occitanie', 'herault', 'h√©rault', 'pic', 'montpellier', 'gard'];
    const PROVENANCE_DISCOVERY_KEYWORDS = ['decouverte', 'd√©couverte', 'voyage', 'ailleurs', 'autre'];
    const getProvenanceMeta = (group) => PROVENANCE_META[group] || { label: toTitle(group), desc: '', icon: '' };
    const classifyProvenanceGroup = (wine) => {
      const raw = getWineTag(wine, 'tag_provenance');
      const norm = normalize(raw);
      if (!norm) return null;
      if (PROVENANCE_LOCAL_KEYWORDS.some(key => norm.includes(key))) return 'local';
      if (PROVENANCE_DISCOVERY_KEYWORDS.some(key => norm.includes(key))) return 'decouverte';
      if (norm.includes('local')) return 'local';
      return 'decouverte';
    };

    const buildProvenanceOptions = (wines = []) => {
      const groups = new Set();
      wines.forEach(wine => {
        const group = classifyProvenanceGroup(wine);
        if (group) groups.add(group);
      });
      return Array.from(groups).sort((a, b) => {
        const ia = PROVENANCE_ORDER.indexOf(a);
        const ib = PROVENANCE_ORDER.indexOf(b);
        return (ia === -1 ? Number.MAX_SAFE_INTEGER : ia) - (ib === -1 ? Number.MAX_SAFE_INTEGER : ib);
      }).map(group => {
        const meta = getProvenanceMeta(group);
        return { value: group, label: meta.label, desc: meta.desc };
      });
    };

    const buildSubstyleOptions = (wines = []) => {
      const map = new Map();
      wines.forEach(wine => {
        const raw = getWineTag(wine, 'tag_sous-style');
        const norm = canonicalSubstyle(raw);
        if (!norm) return;
        if (!map.has(norm)) {
          const meta = getSubstyleMeta(norm, raw);
          map.set(norm, { value: norm, label: meta.label, desc: meta.desc });
        }
      });
      return Array.from(map.values()).sort((a, b) => {
        const ia = SUBSTYLE_ORDER.indexOf(a.value);
        const ib = SUBSTYLE_ORDER.indexOf(b.value);
        if (ia !== ib) {
          return (ia === -1 ? Number.MAX_SAFE_INTEGER : ia) - (ib === -1 ? Number.MAX_SAFE_INTEGER : ib);
        }
        return a.label.localeCompare(b.label, 'fr', { sensitivity: 'base' });
      });
    };

    const styleMatches = (wine, value) => {
      const tag = normalize(getWineTag(wine, 'tag_style'));
      if (!tag) return false;
      if (value === 'nature') return tag.includes('nature') || tag.includes('biodynam') || tag.includes('bio');
      if (value === 'souple') return tag.includes('souple') || tag.includes('fruit');
      if (value === 'puissant') return tag.includes('puissant') || tag.includes('struct');
      if (value === 'sec') return tag.includes('sec') || tag.includes('frais') || tag.includes('miner');
      if (value === 'moelleux') return tag.includes('moelleux') || tag.includes('doux');
      return tag === value;
    };

    const substyleMatches = (wine, value) => {
      const tag = canonicalSubstyle(getWineTag(wine, 'tag_sous-style'));
      if (!tag) return false;
      if (value === 'fruite') return tag.includes('fruite') || tag.includes('fruit');
      return tag === value;
    };

    const isWineByGlass = (wine = {}) => {
      const sectionNorm = normalize(wine?.Section);
      if (sectionNorm.includes('verre')) return true;
      if (sectionNorm.includes('bouteille')) return false;

      const formatNorm = normalize(getWineTag(wine, 'tag_format'));
      if (formatNorm.includes('verre')) return true;
      if (formatNorm.includes('bouteille')) return false;
      return false;
    };
    const isWineRecommended = (wine = {}) => {
      const keys = ['Recommendations', 'Recommendation', 'recommendation', 'Recommandation', 'recommandation', 'Reco', 'reco'];
      return keys.some(key => normalize(wine[key]) === 'oui');
    };

    const matchesSelection = (wine, question, selectionValue) => {
      if (!selectionValue) return true;
      const value = normalize(selectionValue);
      if (typeof question.match === 'function') return question.match(wine, value);
      if (question.tag) {
        const tagValue = getWineTag(wine, question.tag);
        return normalize(tagValue) === value;
      }
      return true;
    };

    const getEligibleWinesForStep = (questions, stepIndex) => {
      if (!Array.isArray(questions) || !questions.length) return wineData;
      const previous = questions.slice(0, stepIndex);
      return wineData.filter(wine => previous.every(q => matchesSelection(wine, q, wineTreeSelections[q.id])));
    };

    const WHITE_STYLE_OPTIONS = [
      { value: 'sec', label: 'Blanc sec', desc: 'Vif, tendu ou min√©ral.' },
      { value: 'moelleux', label: 'Moelleux', desc: 'Doux, gourmand & velout√©.' },
      { value: 'nature', label: 'Biodynamie & nature', desc: 'Sans artifice, vivant.' }
    ];

    const RED_STYLE_OPTIONS = [
      { value: 'souple', label: 'Souple & fruit√©', desc: 'Gamay, pinot, fra√Æcheur.' },
      { value: 'puissant', label: 'Puissant & structur√©', desc: 'Tanins fondus, √©pices.' },
      { value: 'nature', label: 'Biodynamie & nature', desc: 'Jus libre, vibrants.' }
    ];

    const baseWineQuestion = {
      id: 'color',
      tag: 'tag_couleur',
      question: 'Quelle couleur ?',
      options: [
        { value: 'blanc', label: 'Blanc', dotColor: '#E8D9B5', desc: 'Secs, moelleux ou nature.' },
        { value: 'rouge', label: 'Rouge', dotColor: '#7B1F29', desc: 'Souple, structur√© ou nature.' }
      ]
    };

    const whiteFlow = [
      {
        id: 'style',
        question: 'Quel style de blanc ?',
        options: WHITE_STYLE_OPTIONS,
        match: styleMatches
      },
      {
        id: 'origin',
        question: 'Envie d\'une cuv√©e locale ?',
        options: (sel, wines) => buildProvenanceOptions(wines),
        show: (sel) => !!sel.style,
        match: (wine, value) => classifyProvenanceGroup(wine) === value
      },
      {
        id: 'substyle',
        question: 'Quel profil en blanc sec ?',
        options: (sel, wines) => buildSubstyleOptions(wines),
        show: (sel) => normalize(sel.style) === 'sec',
        match: (wine, value) => substyleMatches(wine, value)
      }
    ];

    const redFlow = [
      {
        id: 'style',
        question: 'Quel style de rouge ?',
        options: RED_STYLE_OPTIONS,
        match: styleMatches
      },
      {
        id: 'origin',
        question: 'Plut√¥t local ou escapade ?',
        options: (sel, wines) => buildProvenanceOptions(wines),
        show: (sel) => !!sel.style,
        match: (wine, value) => classifyProvenanceGroup(wine) === value
      }
    ];

    const getWineQuestions = () => {
      const color = normalize(wineTreeSelections.color || '');
      const flow = [baseWineQuestion];
      if (color === 'blanc') {
        flow.push(...whiteFlow);
      } else if (color === 'rouge') {
        flow.push(...redFlow);
      }
      return flow.filter(q => !q.show || q.show(wineTreeSelections));
    };

    const getOptionIconHTML = (opt = {}) => {
      if (opt.dotColor) {
        const safeColor = opt.dotColor;
        return `<span class="wine-color-dot" style="--dot-color:${safeColor}"></span>`;
      }
      if (opt.icon) {
        return `<span class="wine-option-icon">${opt.icon}</span>`;
      }
      return '';
    };

    // SYST√àME DYNAMIQUE - Scoring & priorit√©s commerciales
    const getWinesByPath = (selections) => {
      const normalizedSelections = {
        color: normalize(selections.color || ''),
        style: normalize(selections.style || ''),
        origin: normalize(selections.origin || ''),
        substyle: normalize(selections.substyle || '')
      };

      const filterWithKeys = (keys) => {
        if (!keys.length) return wineData.slice();
        return wineData.filter(wine => keys.every(key => {
          const value = normalizedSelections[key];
          if (!value) return true;
          if (key === 'color') return normalize(getWineTag(wine, 'tag_couleur')) === value;
          if (key === 'style') return styleMatches(wine, value);
          if (key === 'origin') return classifyProvenanceGroup(wine) === value;
          if (key === 'substyle') return substyleMatches(wine, value);
          return true;
        }));
      };

      const requiredKeys = ['color', 'style', 'origin', 'substyle'].filter(key => normalizedSelections[key]);
      let filtered = filterWithKeys(requiredKeys);

      const relaxOrder = ['substyle', 'origin', 'style'];
      for (const key of relaxOrder) {
        if (filtered.length) break;
        const idx = requiredKeys.indexOf(key);
        if (idx !== -1) {
          requiredKeys.splice(idx, 1);
          filtered = filterWithKeys(requiredKeys);
        }
      }

      if (!filtered.length && normalizedSelections.color) {
        filtered = filterWithKeys(['color']);
      }

      if (!filtered.length) {
        filtered = wineData.slice();
      }

      const scored = filtered.map(wine => {
        const matches = {
          color: normalizedSelections.color ? normalize(getWineTag(wine, 'tag_couleur')) === normalizedSelections.color : false,
          style: normalizedSelections.style ? styleMatches(wine, normalizedSelections.style) : false,
          origin: normalizedSelections.origin ? classifyProvenanceGroup(wine) === normalizedSelections.origin : false,
          substyle: normalizedSelections.substyle ? substyleMatches(wine, normalizedSelections.substyle) : false
        };

        let score = 0;
        if (matches.color) score += 12;
        if (matches.style) score += 8;
        if (matches.origin) score += 5;
        if (matches.substyle) score += 4;
        if (!matches.style && normalizedSelections.style) score -= 1;
        if (!matches.origin && normalizedSelections.origin) score -= 1;
        if (!matches.substyle && normalizedSelections.substyle) score -= 1;

        const byGlass = isWineByGlass(wine);
        const recommended = isWineRecommended(wine);
        if (byGlass) score += 2;
        if (recommended) score += 3;

        if (score < 0) score = 0;

        return { wine, score, byGlass, recommended };
      });

      if (!scored.length) {
        if (normalizedSelections.color) {
          return wineData.filter(wine => normalize(getWineTag(wine, 'tag_couleur')) === normalizedSelections.color).slice(0, 6);
        }
        return wineData.slice(0, 6);
      }

      scored.sort((a, b) => {
        if (a.score !== b.score) return b.score - a.score;
        if (a.byGlass !== b.byGlass) return Number(b.byGlass) - Number(a.byGlass);
        return byNameFR(a.wine, b.wine);
      });

      const sortByPriceThenScore = (items) => items.sort((a, b) => {
        const priceA = getPriceValue(a.wine?.Prix);
        const priceB = getPriceValue(b.wine?.Prix);
        const bothFinite = Number.isFinite(priceA) && Number.isFinite(priceB);
        if (bothFinite && priceA !== priceB) return priceA - priceB;
        if (Number.isFinite(priceA) && !Number.isFinite(priceB)) return -1;
        if (!Number.isFinite(priceA) && Number.isFinite(priceB)) return 1;
        if (b.score !== a.score) return b.score - a.score;
        return byNameFR(a.wine, b.wine);
      });

      const byGlassItems = [];
      const recommendedItems = [];
      const otherItems = [];
      for (const item of scored) {
        if (item.byGlass) {
          byGlassItems.push(item);
        } else if (item.recommended) {
          recommendedItems.push(item);
        } else {
          otherItems.push(item);
        }
      }

      const ordered = [
        ...sortByPriceThenScore(byGlassItems),
        ...sortByPriceThenScore(recommendedItems),
        ...sortByPriceThenScore(otherItems)
      ];

      return ordered.slice(0, 6).map(item => item.wine);
    };

    const renderWineTree = () => {
      const panel = qs('#panel-vins');
      if (!panel) return;

      if (showingWineList) {
        renderWineList();
        return;
      }

      const questions = getWineQuestions();

      if (wineTreeStep >= questions.length) {
        renderWineRecommendations();
        return;
      }

      const currentQ = questions[wineTreeStep];
      const eligibleWines = getEligibleWinesForStep(questions, wineTreeStep);
      let options = typeof currentQ.options === 'function'
        ? currentQ.options(wineTreeSelections, eligibleWines)
        : currentQ.options;
      options = Array.isArray(options) ? options.filter(Boolean) : [];

      if (!options.length) {
        delete wineTreeSelections[currentQ.id];
        wineTreeStep++;
        renderWineTree();
        return;
      }

      if (currentQ.autoAdvance !== false && options.length === 1) {
        wineTreeSelections[currentQ.id] = options[0].value;
        wineTreeStep++;
        renderWineTree();
        return;
      }

      const questionText = typeof currentQ.question === 'function'
        ? currentQ.question(wineTreeSelections, eligibleWines)
        : currentQ.question;
      const totalSteps = questions.length;
      const currentStepIndex = Math.min(wineTreeStep + 1, totalSteps);

      let html = `
        <div class="wine-tree">
          <div class="wine-tree-header">
            <svg class="wine-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M7 3h10l-1 6a6 6 0 1 1-8 0z"/><path d="M12 15v6"/>
            </svg>
            <h2 class="wine-tree-title">Guide de s√©lection des vins</h2>
          </div>

          <div class="progress-bar">
            ${questions.map((_, idx) => `<div class="progress-step ${idx <= wineTreeStep ? 'active' : ''}"></div>`).join('')}
          </div>

          <div class="progress-info">√âtape ${currentStepIndex} sur ${totalSteps}</div>

          <h3 class="question-title">${questionText}</h3>

          <div class="wine-options">
            ${options.map(opt => `
              <button class="wine-option" data-value="${opt.value}">
                <div class="wine-option-content">
                  <div class="wine-option-label">
                    ${getOptionIconHTML(opt)}
                    ${opt.label}
                  </div>
                  ${opt.desc ? `<div class="wine-option-desc">${opt.desc}</div>` : ''}
                </div>
                <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 18l6-6-6-6"/>
                </svg>
              </button>
            `).join('')}
          </div>
          
          <div class="wine-nav-btns">
            ${wineTreeStep > 0 ? `
              <button class="wine-btn wine-btn-back" id="wineBackBtn">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M15 18l-6-6 6-6"/>
                </svg>
                Retour
              </button>
            ` : ''}
            <button class="wine-btn wine-btn-secondary" id="showAllWinesFromTreeBtn">
              üìã Voir tous les vins
            </button>
          </div>
        </div>
      `;

      panel.innerHTML = html;

      qsa('.wine-option').forEach(btn => {
        btn.addEventListener('click', () => {
          const value = btn.dataset.value;
          const prevValue = wineTreeSelections[currentQ.id];
          wineTreeSelections[currentQ.id] = value;

          if (currentQ.id === 'color' && value !== prevValue) {
            delete wineTreeSelections.style;
            delete wineTreeSelections.origin;
            delete wineTreeSelections.substyle;
          }

          if (currentQ.id === 'style' && value !== prevValue) {
            delete wineTreeSelections.origin;
            delete wineTreeSelections.substyle;
          }

          wineTreeStep++;
          renderWineTree();
        });
      });

      const backBtn = qs('#wineBackBtn');
      if (backBtn) {
        backBtn.addEventListener('click', () => {
          const prevQ = questions[wineTreeStep - 1];
          delete wineTreeSelections[prevQ.id];
          wineTreeStep--;
          renderWineTree();
        });
      }
      
      const showAllBtn = qs('#showAllWinesFromTreeBtn');
      if (showAllBtn) {
        showAllBtn.addEventListener('click', () => {
          showingWineList = true;
          renderWineList();
        });
      }
    };

    const renderWineRecommendations = () => {
      const panel = qs('#panel-vins');
      if (!panel) return;

      const recommendations = getWinesByPath(wineTreeSelections);

      const recommendationCards = recommendations.length ? recommendations.map(wine => {
        const badges = [];
        if (isWineByGlass(wine)) {
          badges.push('<span class="wine-badge wine-badge-glass">Vin au verre</span>');
        }
        if (isWineRecommended(wine)) {
          badges.push('<span class="wine-badge wine-badge-reco">Recommand√©</span>');
        }
        if (classifyProvenanceGroup(wine) === 'local') {
          const originMeta = getProvenanceMeta('local');
          badges.push(`<span class="wine-badge wine-badge-local">${originMeta.label}</span>`);
        }

        const colorNorm = normalize(getWineTag(wine, 'tag_couleur'));
        const styleRaw = getWineTag(wine, 'tag_style');
        const styleNorm = normalize(styleRaw);
        let styleLabel = '';
        if (styleNorm) {
          if (styleNorm === 'sec') {
            styleLabel = colorNorm === 'blanc' ? 'Blanc sec' : 'Sec';
          } else if (styleNorm === 'moelleux') {
            styleLabel = 'Moelleux';
          } else if (styleNorm === 'souple') {
            styleLabel = 'Souple & fruit√©';
          } else if (styleNorm === 'puissant') {
            styleLabel = 'Puissant & structur√©';
          } else if (styleNorm.includes('nature') || styleNorm.includes('biodynam')) {
            styleLabel = 'Biodynamie & nature';
          } else {
            styleLabel = toTitle(styleRaw || styleNorm);
          }
        }

        const profileParts = [];
        if (styleLabel) profileParts.push(styleLabel);
        const substyleRaw = getWineTag(wine, 'tag_sous-style');
        const substyleNorm = canonicalSubstyle(substyleRaw);
        if (substyleNorm) {
          const meta = getSubstyleMeta(substyleNorm, substyleRaw);
          if (meta.label && !profileParts.includes(meta.label)) profileParts.push(meta.label);
        }
        const formatRaw = getWineTag(wine, 'tag_format');
        const formatNorm = normalize(formatRaw);
        if (formatNorm && !isWineByGlass(wine) && !formatNorm.includes('bouteille')) {
          profileParts.push(toTitle(formatRaw));
        }
        const profileText = profileParts.filter(Boolean).join(' ‚Ä¢ ');

        const badgesHTML = badges.length ? `<div class="wine-card-badges">${badges.join('')}</div>` : '';
        let regionHTML = '';
        let grapesHTML = '';
        const description = wine.Description || '';
        if (description) {
          const parts = description.split(',');
          regionHTML = `<div class="wine-card-region">${parts[0]}</div>`;
          if (parts.length > 1) {
            const rest = parts.slice(1).join(',').trim();
            if (rest) {
              grapesHTML = `<div class="wine-card-grapes">${rest}</div>`;
            }
          }
        }
        const profileHTML = profileText ? `<div class="wine-card-grapes">${profileText}</div>` : '';

        const cardParts = [];
        cardParts.push('<div class="wine-card">');
        if (badgesHTML) cardParts.push(badgesHTML);
        cardParts.push(`<div class="wine-card-header"><div class="wine-card-name">${wine.Nom}</div><div class="wine-card-price">${formatPrice(wine.Prix)}</div></div>`);
        if (regionHTML) cardParts.push(regionHTML);
        if (grapesHTML) cardParts.push(grapesHTML);
        if (profileHTML) cardParts.push(profileHTML);
        cardParts.push('</div>');
        return cardParts.join('');
      }).join('') : '<div class="empty-state"><h3>Aucun vin trouv√©</h3><p>Essayez une autre combinaison ou consultez la carte compl√®te.</p></div>';

      let html = `
        <div class="wine-recommendations">
          <div class="reco-header">
            <svg class="wine-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2l2 5 5 2-5 2-2 5-2-5-5-2 5-2z"/>
            </svg>
            <h2 class="reco-title">Nos recommandations</h2>
          </div>

          ${recommendationCards}

          <div class="wine-nav-btns">
            <button class="wine-btn wine-btn-back" id="wineBackFromRecommendationsBtn">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 18l-6-6 6-6"/>
              </svg>
              Retour
            </button>
            <button class="wine-btn wine-btn-back" id="wineResetBtn">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                <path d="M21 3v5h-5"/>
              </svg>
              Nouvelle recherche
            </button>
            <button class="wine-btn wine-btn-secondary" id="showAllWinesBtn">
              üìã Voir tous les vins
            </button>
          </div>
        </div>
      `;

      panel.innerHTML = html;

      const backBtn = qs('#wineBackFromRecommendationsBtn');
      if (backBtn) {
        backBtn.addEventListener('click', () => {
          const questions = getWineQuestions();
          if (Array.isArray(questions) && questions.length) {
            const prevIndex = Math.max(questions.length - 1, 0);
            const prevQuestion = questions[prevIndex];
            if (prevQuestion) {
              delete wineTreeSelections[prevQuestion.id];
              wineTreeStep = prevIndex;
            } else {
              wineTreeSelections = {};
              wineTreeStep = 0;
            }
          } else {
            wineTreeSelections = {};
            wineTreeStep = 0;
          }
          showingWineList = false;
          renderWineTree();
        });
      }

      const resetBtn = qs('#wineResetBtn');
      if (resetBtn) {
        resetBtn.addEventListener('click', () => {
          wineTreeStep = 0;
          wineTreeSelections = {};
          showingWineList = false;
          renderWineTree();
        });
      }

      qs('#showAllWinesBtn').addEventListener('click', () => {
        showingWineList = true;
        renderWineList();
      });
    };

    const renderWineList = () => {
      const panel = qs('#panel-vins');
      if (!panel) return;

      const groups = new Map();
      for (const wine of wineData) {
        const section = wine.Section || 'Autres';
        if (!groups.has(section)) groups.set(section, []);
        groups.get(section).push(wine);
      }

      let html = '<div style="padding: 1rem;">';
      
      for (const [section, wines] of groups) {
        html += `<h2 class="section-title">${section}</h2>`;
        wines.sort(compareWineByPrice).forEach(wine => {
          html += `
            <div class="menu-item">
              <div class="item-info">
                <div class="item-name">${wine.Nom}</div>
                ${wine.Description ? `<div class="item-description">${wine.Description}</div>` : ''}
              </div>
              <div class="item-price">${formatPrice(wine.Prix)}</div>
            </div>
          `;
        });
      }

      html += `
        <div class="wine-nav-btns" style="margin-top: 2rem;">
          <button class="wine-btn wine-btn-primary" id="backToTreeBtn">
            üç∑ Retour au guide de s√©lection
          </button>
        </div>
      </div>`;

      panel.innerHTML = html;

      qs('#backToTreeBtn').addEventListener('click', () => {
        showingWineList = false;
        wineTreeStep = 0;
        wineTreeSelections = {};
        renderWineTree();
      });
    };

    const panels = {
      now: qs('#panel-now'), deguster: qs('#panel-deguster'), cocktails: qs('#panel-cocktails'),
      chaudes: qs('#panel-chaudes'), bieres: qs('#panel-bieres'), softs: qs('#panel-softs'), vins: qs('#panel-vins')
    };

    const showSkeleton = (el) => {
      el.innerHTML = `
        <div class="now-title">Chargement‚Ä¶</div>
        <div class="menu-item"><span class="skeleton big" style="width:60%"></span><span class="skeleton" style="width:90px"></span></div>
        <div class="menu-item"><span class="skeleton big" style="width:40%"></span><span class="skeleton" style="width:90px"></span></div>`;
    };

    const createItemHTML = (item) => {
      const desc = item.Description ? `<div class="item-description">${item.Description}</div>` : '';
      return `
        <div class="menu-item">
          <div class="item-info">
            <div class="item-name">${item.Nom || ''}</div>
            ${desc}
          </div>
          <div class="item-price">${formatPrice(item.Prix || '')}</div>
        </div>`;
    };

    const renderNow = () => {
      const el = panels.now; if (!el) return;
      let html = `<div class="now-title">√Ä l'affiche en ce moment</div>`;
      const nowItems = allMenuData.filter(i => normalize(i['En ce moment']) === 'oui');
      if (!nowItems.length){
        el.innerHTML = `<div class="empty-state"><h3>Aucune nouveaut√©</h3></div>`;
        return;
      }
      const groups = new Map();
      for (const it of nowItems){
        const key = it.Section || 'Autres';
        if (!groups.has(key)) groups.set(key, []);
        groups.get(key).push(it);
      }
      for (const [section, items] of groups){
        html += `<h2 class="section-title" data-section="${section}">${section}</h2>`;
        items.sort(compareByPrice).forEach(it => { html += createItemHTML(it); });
      }
      el.innerHTML = html;
    };

    const renderTab = (tabName) => {
      if (tabName === 'now') return renderNow();
      if (tabName === 'vins') return renderWineTree();

      const el = panels[tabName]; if (!el) return;
      const tabItems = allMenuData.filter(i => tabIdFromOnglet(i.Onglet) === tabName);
      if (!tabItems.length){
        el.innerHTML = `<div class="empty-state"><h3>Section vide</h3></div>`;
        return;
      }
      const groups = new Map();
      for (const it of tabItems){
        const key = it.Section || 'Autres';
        if (!groups.has(key)) groups.set(key, []);
        groups.get(key).push(it);
      }

      // Trier les sections selon l'ordre d√©fini pour "D√©guster"
      const sortedSections = Array.from(groups.entries()).sort((a, b) => {
        const indexA = getSectionOrderIndex(a[0], tabName);
        const indexB = getSectionOrderIndex(b[0], tabName);
        if (indexA !== -1 && indexB !== -1) return indexA - indexB;
        if (indexA !== -1) return -1;
        if (indexB !== -1) return 1;
        return a[0].localeCompare(b[0], 'fr');
      });

      let html = '';
      for (const [section, items] of sortedSections){
        html += `<h2 class="section-title" data-section="${section}">${section}</h2>`;
        items.sort(compareByPrice).forEach(it => { html += createItemHTML(it); });
      }
      el.innerHTML = html;
    };

    const renderAll = () => {
      for (const key of Object.keys(panels)) renderTab(key);
    };

    const setActiveTab = (tabName) => {
      currentTab = tabName;
      qsa('.tab-btn').forEach(btn => {
        const active = btn.dataset.tab === tabName;
        btn.setAttribute('aria-selected', active ? 'true' : 'false');
        btn.tabIndex = active ? 0 : -1;
      });
      qsa('.tab-content').forEach(p => p.classList.remove('active'));
      qs(`#panel-${tabName}`)?.classList.add('active');
      if (!isSearching) renderTab(tabName);
    };

    const focusNextTab = (dir) => {
      const tabs = qsa('.tab-btn');
      const idx = tabs.findIndex(t => t.getAttribute('aria-selected') === 'true');
      const next = (idx + dir + tabs.length) % tabs.length;
      tabs[next].focus();
      setActiveTab(tabs[next].dataset.tab);
    };

    function ensurePapa(){
      return new Promise((resolve, reject) => {
        if (window.Papa?.parse) return resolve();
        const s = document.createElement('script');
        s.src = 'https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js';
        s.onload = () => window.Papa?.parse ? resolve() : reject();
        s.onerror = reject;
        document.head.appendChild(s);
        setTimeout(() => { if (!window.Papa?.parse) reject(); }, 5000);
      });
    }

    const parseAndSet = (rows=[]) => {
      const sanitize = (r) => { const o={}; for (const k in r){ const nk=(k||'').trim(); let v=r[k]; if (typeof v==='string') v=v.trim(); o[nk]=v; } return o; };
      const cleaned = rows.map(sanitize);
      allMenuData = cleaned.filter(i => normalize(i.Actif) === 'oui' || normalize(i['Actif '])==='oui');
      wineData = allMenuData.filter(i => normalize(i.Onglet).includes('vin'));
      renderAll();
      startPlaceholderRotation();
      hideSplashScreen();
    };

    const loadFromCacheIfFresh = () => {
      try{
        const at = Number(localStorage.getItem(CACHE_AT)||0);
        if (Date.now() - at < CACHE_TTL){
          const cached = JSON.parse(localStorage.getItem(CACHE_KEY)||'[]');
          if (Array.isArray(cached) && cached.length){ parseAndSet(cached); return true; }
        }
      }catch{}
      return false;
    };

    const saveCache = (rows) => {
      try{
        localStorage.setItem(CACHE_KEY, JSON.stringify(rows));
        localStorage.setItem(CACHE_AT, String(Date.now()));
      }catch{}
    };

    const showError = () => { qs('#errorContainer').style.display = 'block'; };
    const hideError = () => { qs('#errorContainer').style.display = 'none'; };

    const fetchCSVAndRender = async () => {
      Object.values(panels).forEach(p => p && showSkeleton(p));
      if (loadFromCacheIfFresh()) return;

      let attempt = 0;
      while (attempt < 3){
        try{
          await new Promise((resolve, reject) => {
            Papa.parse(CSV_URL, {
              download: true,
              header: true,
              complete: (res) => {
                if (res.errors?.length){ reject(res.errors); return; }
                hideError();
                saveCache(res.data);
                parseAndSet(res.data);
                resolve();
              },
              error: reject
            });
          });
          return;
        }catch(e){
          attempt++;
          if (attempt >= 3){ showError(); break; }
          await new Promise(r => setTimeout(r, 400 * Math.pow(2, attempt)));
        }
      }
    };

    const performSearch = (query) => {
      isSearching = true;
      lastQuery = query;
      const q = normalize(query);
      const results = allMenuData.filter(i =>
        normalize(i.Nom).includes(q) || normalize(i.Description).includes(q) || normalize(i.Section).includes(q)
      );
      lastSearchResults = results;
      const info = qs('#searchInfo');
      info.style.display = 'block';
      info.textContent = `${results.length} r√©sultat(s) pour "${query}"`;

      // Afficher les r√©sultats dans le panneau actif
      renderSearchResults(results);
    };

    const renderSearchResults = (results) => {
      const activePanel = qs('.tab-content.active');
      if (!activePanel) return;

      if (!results.length) {
        activePanel.innerHTML = `<div class="empty-state"><h3>Aucun r√©sultat</h3><p>Essayez avec un autre terme de recherche</p></div>`;
        return;
      }

      // Grouper les r√©sultats par section
      const groups = new Map();
      for (const item of results) {
        const key = item.Section || 'Autres';
        if (!groups.has(key)) groups.set(key, []);
        groups.get(key).push(item);
      }

      let html = '';
      for (const [section, items] of groups) {
        html += `<h2 class="section-title" data-section="${section}">${section}</h2>`;
        items.sort(compareByPrice).forEach(item => { html += createItemHTML(item); });
      }
      activePanel.innerHTML = html;
    };

    const clearSearch = () => {
      isSearching = false;
      qs('#searchBox').value = '';
      qs('#searchInfo').style.display = 'none';
      renderTab(currentTab);
    };

    // Gestion du sticky header et back-to-top
    const setupScrollHandlers = () => {
      const stickyHeader = qs('#stickySectionHeader');
      const backToTopBtn = qs('#backToTop');

      if (!stickyHeader || !backToTopBtn) return;

      // Back to top button click
      backToTopBtn.addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });

      // Scroll handler
      const handleScroll = () => {
        // Back to top visibility
        if (window.scrollY > 300) {
          backToTopBtn.classList.add('visible');
        } else {
          backToTopBtn.classList.remove('visible');
        }

        // Sticky header avec nom de section
        const activePanel = qs('.tab-content.active');
        if (!activePanel) {
          stickyHeader.classList.remove('visible');
          return;
        }

        const sectionTitles = activePanel.querySelectorAll('.section-title');
        if (!sectionTitles.length) {
          stickyHeader.classList.remove('visible');
          return;
        }

        let currentSection = null;
        sectionTitles.forEach(title => {
          const rect = title.getBoundingClientRect();
          if (rect.top <= 100) {
            currentSection = title.dataset.section || title.textContent;
          }
        });

        if (currentSection) {
          stickyHeader.textContent = currentSection;
          stickyHeader.classList.add('visible');
        } else {
          stickyHeader.classList.remove('visible');
        }
      };

      window.addEventListener('scroll', handleScroll);
      handleScroll(); // Initial check
    };

    const init = () => {
      qsa('.tab-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          setActiveTab(btn.dataset.tab);
        });
        btn.addEventListener('keydown', (e) => {
          if (e.key === 'ArrowRight') { e.preventDefault(); focusNextTab(+1); }
          if (e.key === 'ArrowLeft')  { e.preventDefault(); focusNextTab(-1); }
        });
      });

      const searchBox = qs('#searchBox');
      const clearBtn = qs('#clearSearch');

      // Bouton croix visible uniquement au focus/contenu
      searchBox.addEventListener('focus', () => {
        clearBtn.classList.add('visible');
      });

      searchBox.addEventListener('blur', () => {
        setTimeout(() => {
          if (!searchBox.value.trim()) {
            clearBtn.classList.remove('visible');
          }
        }, 200);
      });

      searchBox.addEventListener('input', (e) => {
        clearTimeout(searchTimeout);
        const query = e.target.value.trim();

        if (query) {
          clearBtn.classList.add('visible');
        }

        if (!query){
          clearSearch();
          clearBtn.classList.remove('visible');
          return;
        }
        searchTimeout = setTimeout(() => performSearch(query), 250);
      });

      clearBtn.addEventListener('click', () => {
        clearSearch();
        clearBtn.classList.remove('visible');
        searchBox.blur();
      });
      qs('#retryBtn').addEventListener('click', () => ensurePapa().then(fetchCSVAndRender).catch(showError));

      const share = qs('#btnShare');
      if (share){
        share.addEventListener('click', async () => {
          const url = location.href;
          if (navigator.share){ try{ await navigator.share({title:document.title,url}); }catch(e){} }
          else { try{ await navigator.clipboard.writeText(url); }catch(e){} }
        });
      }

      ensurePapa().then(fetchCSVAndRender).catch(showError);
      setupScrollHandlers();
    };

    // Placeholder dynamique - UN SEUL produit, rotation 5s
    const updatePlaceholder = () => {
      const searchBox = qs('#searchBox');
      if (!searchBox || !allMenuData.length) return;

      const nowItems = allMenuData.filter(i => normalize(i['En ce moment']) === 'oui');
      if (nowItems.length > 0) {
        // UN SEUL produit al√©atoire
        const randomIndex = Math.floor(Math.random() * nowItems.length);
        const randomProduct = nowItems[randomIndex].Nom;
        searchBox.placeholder = `Rechercher‚Ä¶ (ex: ${randomProduct})`;
      }
    };

    const startPlaceholderRotation = () => {
      updatePlaceholder();
      placeholderInterval = setInterval(updatePlaceholder, 5000); // 5 secondes
    };

    // Gestion du Splash Screen
    let splashTimeout;
    const hideSplashScreen = () => {
      const splash = qs('#splashScreen');
      if (!splash) return;

      // Attendre au minimum 2 secondes pour l'effet premium
      const minDisplayTime = 2000;
      const elapsed = Date.now() - (window.splashStartTime || 0);
      const remainingTime = Math.max(0, minDisplayTime - elapsed);

      setTimeout(() => {
        splash.classList.add('fade-out');
        setTimeout(() => {
          splash.style.display = 'none';
        }, 500);
      }, remainingTime);
    };

    // Enregistrer l'heure de d√©but au chargement de la page
    window.splashStartTime = Date.now();

    // Fallback : cacher le splash apr√®s 5 secondes maximum
    window.addEventListener('load', () => {
      splashTimeout = setTimeout(hideSplashScreen, 5000);
    });

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>


